(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{588:function(e,r,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/time-capsules",function(){return a(7139)}])},2712:function(e,r,a){"use strict";a.d(r,{V:function(){return g}});var t=a(9828),s=a(3977),i=a(2370);let l=(0,s.ZF)({apiKey:"AIzaSyCChi0l5ugHn8q83GfrC1dY4Sihn2HwHUA",authDomain:"forfutureme-55cd2.firebaseapp.com",projectId:"forfutureme-55cd2",storageBucket:"forfutureme-55cd2.firebasestorage.app",messagingSenderId:"822297739285",appId:"1:822297739285:web:bcc265c9c349d118a24e1c",measurementId:"G-WKNWXRY24T"}),n=(0,t.ad)(l);(0,i.v0)(l);var o=a(162),c=a(3454);let d=()=>o.createTransport({service:"gmail",auth:{user:c.env.EMAIL_USER,pass:c.env.EMAIL_PASS}}),m=e=>'\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset="utf-8">\n      <title>Your Time Capsule Message Has Arrived! ⏰</title>\n      <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }\n        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }\n        .message-box { background: white; padding: 25px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea; }\n        .message-text { font-style: italic; font-size: 18px; line-height: 1.6; color: #555; }\n        .footer { text-align: center; margin-top: 30px; color: #666; font-size: 14px; }\n        .timestamp { background: #e8f4fd; padding: 15px; border-radius: 5px; margin: 15px 0; font-size: 14px; }\n      </style>\n    </head>\n    <body>\n      <div class="container">\n        <div class="header">\n          <h1>⏰ Your Time Capsule Message Has Arrived!</h1>\n          <p>A message from your past self has reached its destination</p>\n        </div>\n        \n        <div class="content">\n          <div class="timestamp">\n            <strong>Sent on:</strong> '.concat(e.createdAt.toLocaleDateString()," at ").concat(e.createdAt.toLocaleTimeString(),"<br>\n            <strong>Delivered on:</strong> ").concat(new Date().toLocaleDateString()," at ").concat(new Date().toLocaleTimeString(),'\n          </div>\n          \n          <div class="message-box">\n            <div class="message-text">').concat(e.message,'</div>\n          </div>\n          \n          <p style="text-align: center; margin-top: 30px;">\n            <em>"The best time to plant a tree was 20 years ago. The second best time is now."</em>\n          </p>\n        </div>\n        \n        <div class="footer">\n          <p>Sent with ❤️ from TimeSend</p>\n          <p>Your personal time capsule service</p>\n        </div>\n      </div>\n    </body>\n    </html>\n  '),g={async createTimeCapsule(e){try{return(await (0,t.ET)((0,t.hJ)(n,"timeCapsules"),{...e,createdAt:t.EK.now(),isDelivered:!1,deliveryDate:t.EK.fromDate(e.deliveryDate)})).id}catch(e){throw console.error("Error creating time capsule:",e),Error("Failed to create time capsule")}},async getTimeCapsulesByEmail(e){try{let r=(0,t.IO)((0,t.hJ)(n,"timeCapsules"),(0,t.ar)("emails","array-contains",e),(0,t.ar)("isDelivered","==",!1)),a=await (0,t.PL)(r),s=[];return a.forEach(e=>{let r=e.data();s.push({id:e.id,message:r.message,emails:r.emails,deliveryDate:r.deliveryDate.toDate(),createdAt:r.createdAt.toDate(),isDelivered:r.isDelivered})}),s}catch(e){throw console.error("Error getting time capsules:",e),Error("Failed to get time capsules")}},async markAsDelivered(e){try{let r=(0,t.JU)(n,"timeCapsules",e);await (0,t.oe)(r)}catch(e){throw console.error("Error marking time capsule as delivered:",e),Error("Failed to mark time capsule as delivered")}},async getTimeCapsulesReadyForDelivery(){try{let e=new Date,r=(0,t.IO)((0,t.hJ)(n,"timeCapsules"),(0,t.ar)("deliveryDate","<=",t.EK.fromDate(e)),(0,t.ar)("isDelivered","==",!1)),a=await (0,t.PL)(r),s=[];return a.forEach(e=>{let r=e.data();s.push({id:e.id,message:r.message,emails:r.emails,deliveryDate:r.deliveryDate.toDate(),createdAt:r.createdAt.toDate(),isDelivered:r.isDelivered})}),s}catch(e){throw console.error("Error getting time capsules ready for delivery:",e),Error("Failed to get time capsules ready for delivery")}},async deliverTimeCapsulesImmediately(){try{console.log("\uD83D\uDD50 Starting immediate time capsule delivery...");let e=await this.getTimeCapsulesReadyForDelivery();if(console.log("\uD83D\uDCE6 Found ".concat(e.length," time capsules ready for delivery")),0===e.length)return{delivered:0,totalCapsules:0,errors:[]};let r=0,a=[],t=d();for(let s of e)if(s.id){for(let e of(console.log("\uD83D\uDCE7 Processing time capsule ".concat(s.id," for immediate delivery")),s.emails))try{console.log("\uD83D\uDCE4 Sending email to ".concat(e,"..."));let a={from:c.env.EMAIL_USER,to:e,subject:"⏰ Your Time Capsule Message Has Arrived!",html:m(s)},i=await t.sendMail(a);console.log("✅ Email sent successfully to ".concat(e,":"),i.messageId),r++}catch(t){let r="Failed to send email to ".concat(e,": ").concat(t instanceof Error?t.message:"Unknown error");console.error("❌ ".concat(r)),a.push(r)}try{await this.markAsDelivered(s.id),console.log("✅ Time capsule ".concat(s.id," marked as delivered"))}catch(r){let e="Failed to mark time capsule ".concat(s.id," as delivered: ").concat(r instanceof Error?r.message:"Unknown error");console.error("❌ ".concat(e)),a.push(e)}}return console.log("\uD83C\uDF89 Immediate delivery complete! ".concat(r," emails sent")),{delivered:r,totalCapsules:e.length,errors:a}}catch(e){throw console.error("❌ Error processing immediate time capsule delivery:",e),Error("Failed to process immediate delivery: ".concat(e instanceof Error?e.message:"Unknown error"))}},async isTimeCapsuleReadyForDelivery(e){try{let r=new Date,a=(0,t.IO)((0,t.hJ)(n,"timeCapsules"),(0,t.ar)("__name__","==",e),(0,t.ar)("deliveryDate","<=",t.EK.fromDate(r)),(0,t.ar)("isDelivered","==",!1));return!(await (0,t.PL)(a)).empty}catch(e){return console.error("Error checking if time capsule is ready for delivery:",e),!1}},async deliverSpecificTimeCapsule(e){try{if(!await this.isTimeCapsuleReadyForDelivery(e))return{success:!1,delivered:0,errors:["Time capsule is not ready for delivery yet"]};let r=(await this.getTimeCapsulesReadyForDelivery()).find(r=>r.id===e);if(!r)return{success:!1,delivered:0,errors:["Time capsule not found or already delivered"]};let a=0,t=[],s=d();for(let i of(console.log("\uD83D\uDCE7 Processing specific time capsule ".concat(e," for immediate delivery")),r.emails))try{console.log("\uD83D\uDCE4 Sending email to ".concat(i,"..."));let e={from:c.env.EMAIL_USER,to:i,subject:"⏰ Your Time Capsule Message Has Arrived!",html:m(r)},t=await s.sendMail(e);console.log("✅ Email sent successfully to ".concat(i,":"),t.messageId),a++}catch(r){let e="Failed to send email to ".concat(i,": ").concat(r instanceof Error?r.message:"Unknown error");console.error("❌ ".concat(e)),t.push(e)}try{await this.markAsDelivered(e),console.log("✅ Time capsule ".concat(e," marked as delivered"))}catch(a){let r="Failed to mark time capsule ".concat(e," as delivered: ").concat(a instanceof Error?a.message:"Unknown error");console.error("❌ ".concat(r)),t.push(r)}return{success:!0,delivered:a,errors:t}}catch(e){return console.error("❌ Error processing specific time capsule delivery:",e),{success:!1,delivered:0,errors:["Failed to process delivery: ".concat(e instanceof Error?e.message:"Unknown error")]}}}}},7139:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return l}});var t=a(5893),s=a(7294),i=a(2712);function l(){let[e,r]=(0,s.useState)([]),[a,l]=(0,s.useState)(!1),[n,o]=(0,s.useState)("");(0,s.useEffect)(()=>{c()},[]);let c=async()=>{try{l(!0);let e=await i.V.getTimeCapsulesByEmail("admin@example.com"),a=new Date,t=e.filter(e=>e.deliveryDate<=a&&!e.isDelivered);r(t)}catch(e){console.error("Error loading pending capsules:",e)}finally{l(!1)}},d=async()=>{try{l(!0),o("Triggering delivery...");let e=await fetch("/api/manual-delivery",{method:"POST",headers:{"Content-Type":"application/json"}}),r=await e.json();e.ok?(o("✅ Delivery completed! ".concat(r.delivered," emails sent")),await c()):o("❌ Error: ".concat(r.message))}catch(e){console.error("Error triggering delivery:",e),o("❌ Failed to trigger delivery")}finally{l(!1)}},m=e=>new Date(e).toLocaleString();return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-8",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-8",children:"⏰ Time Capsule Admin Panel"}),(0,t.jsxs)("div",{className:"bg-blue-50 rounded-lg p-6 mb-8",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-blue-800 mb-4",children:"Manual Delivery Trigger"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Click the button below to manually trigger delivery of all time capsules that are ready."}),(0,t.jsx)("button",{onClick:d,disabled:a,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:a?"Processing...":"\uD83D\uDE80 Trigger Delivery Now"}),n&&(0,t.jsx)("div",{className:"mt-4 p-3 rounded-lg bg-gray-100",children:(0,t.jsx)("p",{className:"text-sm",children:n})})]}),(0,t.jsxs)("div",{className:"bg-green-50 rounded-lg p-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold text-green-800 mb-4",children:["Pending Time Capsules (",e.length,")"]}),a?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading..."})]}):0===e.length?(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-gray-500",children:"No pending time capsules found."})}):(0,t.jsx)("div",{className:"space-y-4",children:e.map((e,r)=>{var a;return(0,t.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,t.jsxs)("h3",{className:"font-semibold text-gray-800",children:["Time Capsule #",(null===(a=e.id)||void 0===a?void 0:a.slice(-8))||r+1]}),(0,t.jsx)("span",{className:"text-sm text-gray-500",children:e.isDelivered?"✅ Delivered":"⏳ Pending"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Message:"}),(0,t.jsxs)("p",{className:"text-gray-700 mt-1 italic",children:['"',e.message,'"']})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Recipients:"}),(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:e.emails.join(", ")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Created:"}),(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:m(e.createdAt)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Delivery Date:"}),(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:m(e.deliveryDate)})]})]})]},e.id||r)})})]}),(0,t.jsxs)("div",{className:"mt-8 bg-gray-50 rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"System Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Automated Delivery:"}),(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:"Every 6 hours via Vercel Cron"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Email Service:"}),(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:"Gmail (via Nodemailer)"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Database:"}),(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:"Firebase Firestore"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Current Time:"}),(0,t.jsx)("p",{className:"text-gray-700 mt-1",children:new Date().toLocaleString()})]})]})]})]})})})}}},function(e){e.O(0,[16,227,714,892,888,774,179],function(){return e(e.s=588)}),_N_E=e.O()}]);