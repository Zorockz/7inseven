(()=>{var e={};e.id=814,e.ids=[814,888,660],e.modules={1323:(e,r)=>{"use strict";Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},9277:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>v,default:()=>u,getServerSideProps:()=>h,getStaticPaths:()=>p,getStaticProps:()=>g,reportWebVitals:()=>y,routeModule:()=>j,unstable_getServerProps:()=>D,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>x});var a=t(7093),i=t(5244),l=t(1323),o=t(2899),n=t.n(o),d=t(6814),c=t(7139),m=e([c]);c=(m.then?(await m)():m)[0];let u=(0,l.l)(c,"default"),g=(0,l.l)(c,"getStaticProps"),p=(0,l.l)(c,"getStaticPaths"),h=(0,l.l)(c,"getServerSideProps"),v=(0,l.l)(c,"config"),y=(0,l.l)(c,"reportWebVitals"),x=(0,l.l)(c,"unstable_getStaticProps"),f=(0,l.l)(c,"unstable_getStaticPaths"),b=(0,l.l)(c,"unstable_getStaticParams"),D=(0,l.l)(c,"unstable_getServerProps"),w=(0,l.l)(c,"unstable_getServerSideProps"),j=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/admin/time-capsules",pathname:"/admin/time-capsules",bundlePath:"",filename:""},components:{App:d.default,Document:n()},userland:c});s()}catch(e){s(e)}})},252:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(r,{db:()=>d});var a=t(3745),i=t(1492),l=t(401),o=e([a,i,l]);[a,i,l]=o.then?(await o)():o;let n=(0,a.initializeApp)({apiKey:"AIzaSyCChi0l5ugHn8q83GfrC1dY4Sihn2HwHUA",authDomain:"forfutureme-55cd2.firebaseapp.com",projectId:"forfutureme-55cd2",storageBucket:"forfutureme-55cd2.firebasestorage.app",messagingSenderId:"822297739285",appId:"1:822297739285:web:bcc265c9c349d118a24e1c",measurementId:"G-WKNWXRY24T"}),d=(0,i.getFirestore)(n);(0,l.getAuth)(n),s()}catch(e){s(e)}})},2573:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(r,{V:()=>m});var a=t(1492),i=t(252),l=t(5184),o=t.n(l),n=e([a,i]);[a,i]=n.then?(await n)():n;let d=()=>o().createTransport({service:"gmail",auth:{user:process.env.EMAIL_USER,pass:process.env.EMAIL_PASS}}),c=e=>`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <title>Your Time Capsule Message Has Arrived! ‚è∞</title>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .message-box { background: white; padding: 25px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea; }
        .message-text { font-style: italic; font-size: 18px; line-height: 1.6; color: #555; }
        .footer { text-align: center; margin-top: 30px; color: #666; font-size: 14px; }
        .timestamp { background: #e8f4fd; padding: 15px; border-radius: 5px; margin: 15px 0; font-size: 14px; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>‚è∞ Your Time Capsule Message Has Arrived!</h1>
          <p>A message from your past self has reached its destination</p>
        </div>
        
        <div class="content">
          <div class="timestamp">
            <strong>Sent on:</strong> ${e.createdAt.toLocaleDateString()} at ${e.createdAt.toLocaleTimeString()}<br>
            <strong>Delivered on:</strong> ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
          </div>
          
          <div class="message-box">
            <div class="message-text">${e.message}</div>
          </div>
          
          <p style="text-align: center; margin-top: 30px;">
            <em>"The best time to plant a tree was 20 years ago. The second best time is now."</em>
          </p>
        </div>
        
        <div class="footer">
          <p>Sent with ‚ù§Ô∏è from TimeSend</p>
          <p>Your personal time capsule service</p>
        </div>
      </div>
    </body>
    </html>
  `,m={async createTimeCapsule(e){try{return(await (0,a.addDoc)((0,a.collection)(i.db,"timeCapsules"),{...e,createdAt:a.Timestamp.now(),isDelivered:!1,deliveryDate:a.Timestamp.fromDate(e.deliveryDate)})).id}catch(e){throw console.error("Error creating time capsule:",e),Error("Failed to create time capsule")}},async getTimeCapsulesByEmail(e){try{let r=(0,a.query)((0,a.collection)(i.db,"timeCapsules"),(0,a.where)("emails","array-contains",e),(0,a.where)("isDelivered","==",!1)),t=await (0,a.getDocs)(r),s=[];return t.forEach(e=>{let r=e.data();s.push({id:e.id,message:r.message,emails:r.emails,deliveryDate:r.deliveryDate.toDate(),createdAt:r.createdAt.toDate(),isDelivered:r.isDelivered})}),s}catch(e){throw console.error("Error getting time capsules:",e),Error("Failed to get time capsules")}},async markAsDelivered(e){try{let r=(0,a.doc)(i.db,"timeCapsules",e);await (0,a.deleteDoc)(r)}catch(e){throw console.error("Error marking time capsule as delivered:",e),Error("Failed to mark time capsule as delivered")}},async getTimeCapsulesReadyForDelivery(){try{let e=new Date,r=(0,a.query)((0,a.collection)(i.db,"timeCapsules"),(0,a.where)("deliveryDate","<=",a.Timestamp.fromDate(e)),(0,a.where)("isDelivered","==",!1)),t=await (0,a.getDocs)(r),s=[];return t.forEach(e=>{let r=e.data();s.push({id:e.id,message:r.message,emails:r.emails,deliveryDate:r.deliveryDate.toDate(),createdAt:r.createdAt.toDate(),isDelivered:r.isDelivered})}),s}catch(e){throw console.error("Error getting time capsules ready for delivery:",e),Error("Failed to get time capsules ready for delivery")}},async deliverTimeCapsulesImmediately(){try{console.log("\uD83D\uDD50 Starting immediate time capsule delivery...");let e=await this.getTimeCapsulesReadyForDelivery();if(console.log(`üì¶ Found ${e.length} time capsules ready for delivery`),0===e.length)return{delivered:0,totalCapsules:0,errors:[]};let r=0,t=[],s=d();for(let a of e)if(a.id){for(let e of(console.log(`üìß Processing time capsule ${a.id} for immediate delivery`),a.emails))try{console.log(`üì§ Sending email to ${e}...`);let t={from:process.env.EMAIL_USER,to:e,subject:"‚è∞ Your Time Capsule Message Has Arrived!",html:c(a)},i=await s.sendMail(t);console.log(`‚úÖ Email sent successfully to ${e}:`,i.messageId),r++}catch(s){let r=`Failed to send email to ${e}: ${s instanceof Error?s.message:"Unknown error"}`;console.error(`‚ùå ${r}`),t.push(r)}try{await this.markAsDelivered(a.id),console.log(`‚úÖ Time capsule ${a.id} marked as delivered`)}catch(r){let e=`Failed to mark time capsule ${a.id} as delivered: ${r instanceof Error?r.message:"Unknown error"}`;console.error(`‚ùå ${e}`),t.push(e)}}return console.log(`üéâ Immediate delivery complete! ${r} emails sent`),{delivered:r,totalCapsules:e.length,errors:t}}catch(e){throw console.error("‚ùå Error processing immediate time capsule delivery:",e),Error(`Failed to process immediate delivery: ${e instanceof Error?e.message:"Unknown error"}`)}},async isTimeCapsuleReadyForDelivery(e){try{let r=new Date,t=(0,a.query)((0,a.collection)(i.db,"timeCapsules"),(0,a.where)("__name__","==",e),(0,a.where)("deliveryDate","<=",a.Timestamp.fromDate(r)),(0,a.where)("isDelivered","==",!1));return!(await (0,a.getDocs)(t)).empty}catch(e){return console.error("Error checking if time capsule is ready for delivery:",e),!1}},async deliverSpecificTimeCapsule(e){try{if(!await this.isTimeCapsuleReadyForDelivery(e))return{success:!1,delivered:0,errors:["Time capsule is not ready for delivery yet"]};let r=(await this.getTimeCapsulesReadyForDelivery()).find(r=>r.id===e);if(!r)return{success:!1,delivered:0,errors:["Time capsule not found or already delivered"]};let t=0,s=[],a=d();for(let i of(console.log(`üìß Processing specific time capsule ${e} for immediate delivery`),r.emails))try{console.log(`üì§ Sending email to ${i}...`);let e={from:process.env.EMAIL_USER,to:i,subject:"‚è∞ Your Time Capsule Message Has Arrived!",html:c(r)},s=await a.sendMail(e);console.log(`‚úÖ Email sent successfully to ${i}:`,s.messageId),t++}catch(r){let e=`Failed to send email to ${i}: ${r instanceof Error?r.message:"Unknown error"}`;console.error(`‚ùå ${e}`),s.push(e)}try{await this.markAsDelivered(e),console.log(`‚úÖ Time capsule ${e} marked as delivered`)}catch(t){let r=`Failed to mark time capsule ${e} as delivered: ${t instanceof Error?t.message:"Unknown error"}`;console.error(`‚ùå ${r}`),s.push(r)}return{success:!0,delivered:t,errors:s}}catch(e){return console.error("‚ùå Error processing specific time capsule delivery:",e),{success:!1,delivered:0,errors:[`Failed to process delivery: ${e instanceof Error?e.message:"Unknown error"}`]}}}};s()}catch(e){s(e)}})},6814:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});var s=t(997);t(6764);let a=function({Component:e,pageProps:r}){return s.jsx(e,{...r})}},7139:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>n});var a=t(997),i=t(6689),l=t(2573),o=e([l]);function n(){let[e,r]=(0,i.useState)([]),[t,s]=(0,i.useState)(!1),[o,n]=(0,i.useState)(""),d=async()=>{try{s(!0);let e=await l.V.getTimeCapsulesByEmail("admin@example.com"),t=new Date,a=e.filter(e=>e.deliveryDate<=t&&!e.isDelivered);r(a)}catch(e){console.error("Error loading pending capsules:",e)}finally{s(!1)}},c=async()=>{try{s(!0),n("Triggering delivery...");let e=await fetch("/api/manual-delivery",{method:"POST",headers:{"Content-Type":"application/json"}}),r=await e.json();e.ok?(n(`‚úÖ Delivery completed! ${r.delivered} emails sent`),await d()):n(`‚ùå Error: ${r.message}`)}catch(e){console.error("Error triggering delivery:",e),n("‚ùå Failed to trigger delivery")}finally{s(!1)}},m=e=>new Date(e).toLocaleString();return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-8",children:a.jsx("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-8",children:"‚è∞ Time Capsule Admin Panel"}),(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-6 mb-8",children:[a.jsx("h2",{className:"text-xl font-semibold text-blue-800 mb-4",children:"Manual Delivery Trigger"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Click the button below to manually trigger delivery of all time capsules that are ready."}),a.jsx("button",{onClick:c,disabled:t,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:t?"Processing...":"\uD83D\uDE80 Trigger Delivery Now"}),o&&a.jsx("div",{className:"mt-4 p-3 rounded-lg bg-gray-100",children:a.jsx("p",{className:"text-sm",children:o})})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-green-800 mb-4",children:["Pending Time Capsules (",e.length,")"]}),t?(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),a.jsx("p",{className:"mt-2 text-gray-600",children:"Loading..."})]}):0===e.length?a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-gray-500",children:"No pending time capsules found."})}):a.jsx("div",{className:"space-y-4",children:e.map((e,r)=>(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsxs)("h3",{className:"font-semibold text-gray-800",children:["Time Capsule #",e.id?.slice(-8)||r+1]}),a.jsx("span",{className:"text-sm text-gray-500",children:e.isDelivered?"‚úÖ Delivered":"‚è≥ Pending"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Message:"}),(0,a.jsxs)("p",{className:"text-gray-700 mt-1 italic",children:['"',e.message,'"']})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Recipients:"}),a.jsx("p",{className:"text-gray-700 mt-1",children:e.emails.join(", ")})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Created:"}),a.jsx("p",{className:"text-gray-700 mt-1",children:m(e.createdAt)})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Delivery Date:"}),a.jsx("p",{className:"text-gray-700 mt-1",children:m(e.deliveryDate)})]})]})]},e.id||r))})]}),(0,a.jsxs)("div",{className:"mt-8 bg-gray-50 rounded-lg p-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"System Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Automated Delivery:"}),a.jsx("p",{className:"text-gray-700 mt-1",children:"Every 6 hours via Vercel Cron"})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Email Service:"}),a.jsx("p",{className:"text-gray-700 mt-1",children:"Gmail (via Nodemailer)"})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Database:"}),a.jsx("p",{className:"text-gray-700 mt-1",children:"Firebase Firestore"})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Current Time:"}),a.jsx("p",{className:"text-gray-700 mt-1",children:new Date().toLocaleString()})]})]})]})]})})})}l=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},6764:()=>{},5244:(e,r)=>{"use strict";var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},5184:e=>{"use strict";e.exports=require("nodemailer")},6689:e=>{"use strict";e.exports=require("react")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},3745:e=>{"use strict";e.exports=import("firebase/app")},401:e=>{"use strict";e.exports=import("firebase/auth")},1492:e=>{"use strict";e.exports=import("firebase/firestore")},1017:e=>{"use strict";e.exports=require("path")}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[899],()=>t(9277));module.exports=s})();