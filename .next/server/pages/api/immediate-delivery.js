"use strict";(()=>{var e={};e.id=569,e.ids=[569],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5184:e=>{e.exports=require("nodemailer")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},5088:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>c,default:()=>n,routeModule:()=>m});var i=t(1802),s=t(7153),o=t(6249),l=t(3521),d=e([l]);l=(d.then?(await d)():d)[0];let n=(0,o.l)(l,"default"),c=(0,o.l)(l,"config"),m=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/immediate-delivery",pathname:"/api/immediate-delivery",bundlePath:"",filename:""},userland:l});a()}catch(e){a(e)}})},7192:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{db:()=>n});var i=t(3745),s=t(1492),o=t(401),l=e([i,s,o]);[i,s,o]=l.then?(await l)():l;let d=(0,i.initializeApp)({apiKey:"AIzaSyCChi0l5ugHn8q83GfrC1dY4Sihn2HwHUA",authDomain:"forfutureme-55cd2.firebaseapp.com",projectId:"forfutureme-55cd2",storageBucket:"forfutureme-55cd2.firebasestorage.app",messagingSenderId:"822297739285",appId:"1:822297739285:web:bcc265c9c349d118a24e1c",measurementId:"G-WKNWXRY24T"}),n=(0,s.getFirestore)(d);(0,o.getAuth)(d),a()}catch(e){a(e)}})},919:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{V:()=>m});var i=t(1492),s=t(7192),o=t(5184),l=t.n(o),d=e([i,s]);[i,s]=d.then?(await d)():d;let n=()=>l().createTransport({service:"gmail",auth:{user:process.env.EMAIL_USER,pass:process.env.EMAIL_PASS}}),c=e=>`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <title>Your Time Capsule Message Has Arrived! ‚è∞</title>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .message-box { background: white; padding: 25px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea; }
        .message-text { font-style: italic; font-size: 18px; line-height: 1.6; color: #555; }
        .footer { text-align: center; margin-top: 30px; color: #666; font-size: 14px; }
        .timestamp { background: #e8f4fd; padding: 15px; border-radius: 5px; margin: 15px 0; font-size: 14px; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>‚è∞ Your Time Capsule Message Has Arrived!</h1>
          <p>A message from your past self has reached its destination</p>
        </div>
        
        <div class="content">
          <div class="timestamp">
            <strong>Sent on:</strong> ${e.createdAt.toLocaleDateString()} at ${e.createdAt.toLocaleTimeString()}<br>
            <strong>Delivered on:</strong> ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
          </div>
          
          <div class="message-box">
            <div class="message-text">${e.message}</div>
          </div>
          
          <p style="text-align: center; margin-top: 30px;">
            <em>"The best time to plant a tree was 20 years ago. The second best time is now."</em>
          </p>
        </div>
        
        <div class="footer">
          <p>Sent with ‚ù§Ô∏è from TimeSend</p>
          <p>Your personal time capsule service</p>
        </div>
      </div>
    </body>
    </html>
  `,m={async createTimeCapsule(e){try{return(await (0,i.addDoc)((0,i.collection)(s.db,"timeCapsules"),{...e,createdAt:i.Timestamp.now(),isDelivered:!1,deliveryDate:i.Timestamp.fromDate(e.deliveryDate)})).id}catch(e){throw console.error("Error creating time capsule:",e),Error("Failed to create time capsule")}},async getTimeCapsulesByEmail(e){try{let r=(0,i.query)((0,i.collection)(s.db,"timeCapsules"),(0,i.where)("emails","array-contains",e),(0,i.where)("isDelivered","==",!1)),t=await (0,i.getDocs)(r),a=[];return t.forEach(e=>{let r=e.data();a.push({id:e.id,message:r.message,emails:r.emails,deliveryDate:r.deliveryDate.toDate(),createdAt:r.createdAt.toDate(),isDelivered:r.isDelivered})}),a}catch(e){throw console.error("Error getting time capsules:",e),Error("Failed to get time capsules")}},async markAsDelivered(e){try{let r=(0,i.doc)(s.db,"timeCapsules",e);await (0,i.deleteDoc)(r)}catch(e){throw console.error("Error marking time capsule as delivered:",e),Error("Failed to mark time capsule as delivered")}},async getTimeCapsulesReadyForDelivery(){try{let e=new Date,r=(0,i.query)((0,i.collection)(s.db,"timeCapsules"),(0,i.where)("deliveryDate","<=",i.Timestamp.fromDate(e)),(0,i.where)("isDelivered","==",!1)),t=await (0,i.getDocs)(r),a=[];return t.forEach(e=>{let r=e.data();a.push({id:e.id,message:r.message,emails:r.emails,deliveryDate:r.deliveryDate.toDate(),createdAt:r.createdAt.toDate(),isDelivered:r.isDelivered})}),a}catch(e){throw console.error("Error getting time capsules ready for delivery:",e),Error("Failed to get time capsules ready for delivery")}},async deliverTimeCapsulesImmediately(){try{console.log("\uD83D\uDD50 Starting immediate time capsule delivery...");let e=await this.getTimeCapsulesReadyForDelivery();if(console.log(`üì¶ Found ${e.length} time capsules ready for delivery`),0===e.length)return{delivered:0,totalCapsules:0,errors:[]};let r=0,t=[],a=n();for(let i of e)if(i.id){for(let e of(console.log(`üìß Processing time capsule ${i.id} for immediate delivery`),i.emails))try{console.log(`üì§ Sending email to ${e}...`);let t={from:process.env.EMAIL_USER,to:e,subject:"‚è∞ Your Time Capsule Message Has Arrived!",html:c(i)},s=await a.sendMail(t);console.log(`‚úÖ Email sent successfully to ${e}:`,s.messageId),r++}catch(a){let r=`Failed to send email to ${e}: ${a instanceof Error?a.message:"Unknown error"}`;console.error(`‚ùå ${r}`),t.push(r)}try{await this.markAsDelivered(i.id),console.log(`‚úÖ Time capsule ${i.id} marked as delivered`)}catch(r){let e=`Failed to mark time capsule ${i.id} as delivered: ${r instanceof Error?r.message:"Unknown error"}`;console.error(`‚ùå ${e}`),t.push(e)}}return console.log(`üéâ Immediate delivery complete! ${r} emails sent`),{delivered:r,totalCapsules:e.length,errors:t}}catch(e){throw console.error("‚ùå Error processing immediate time capsule delivery:",e),Error(`Failed to process immediate delivery: ${e instanceof Error?e.message:"Unknown error"}`)}},async isTimeCapsuleReadyForDelivery(e){try{let r=new Date,t=(0,i.query)((0,i.collection)(s.db,"timeCapsules"),(0,i.where)("__name__","==",e),(0,i.where)("deliveryDate","<=",i.Timestamp.fromDate(r)),(0,i.where)("isDelivered","==",!1));return!(await (0,i.getDocs)(t)).empty}catch(e){return console.error("Error checking if time capsule is ready for delivery:",e),!1}},async deliverSpecificTimeCapsule(e){try{if(!await this.isTimeCapsuleReadyForDelivery(e))return{success:!1,delivered:0,errors:["Time capsule is not ready for delivery yet"]};let r=(await this.getTimeCapsulesReadyForDelivery()).find(r=>r.id===e);if(!r)return{success:!1,delivered:0,errors:["Time capsule not found or already delivered"]};let t=0,a=[],i=n();for(let s of(console.log(`üìß Processing specific time capsule ${e} for immediate delivery`),r.emails))try{console.log(`üì§ Sending email to ${s}...`);let e={from:process.env.EMAIL_USER,to:s,subject:"‚è∞ Your Time Capsule Message Has Arrived!",html:c(r)},a=await i.sendMail(e);console.log(`‚úÖ Email sent successfully to ${s}:`,a.messageId),t++}catch(r){let e=`Failed to send email to ${s}: ${r instanceof Error?r.message:"Unknown error"}`;console.error(`‚ùå ${e}`),a.push(e)}try{await this.markAsDelivered(e),console.log(`‚úÖ Time capsule ${e} marked as delivered`)}catch(t){let r=`Failed to mark time capsule ${e} as delivered: ${t instanceof Error?t.message:"Unknown error"}`;console.error(`‚ùå ${r}`),a.push(r)}return{success:!0,delivered:t,errors:a}}catch(e){return console.error("‚ùå Error processing specific time capsule delivery:",e),{success:!1,delivered:0,errors:[`Failed to process delivery: ${e instanceof Error?e.message:"Unknown error"}`]}}}};a()}catch(e){a(e)}})},3521:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>o});var i=t(919),s=e([i]);async function o(e,r){if("POST"!==e.method)return r.status(405).json({message:"Method not allowed"});try{let{timeCapsuleId:t}=e.body;if(t){console.log(`üéØ Processing immediate delivery for specific time capsule: ${t}`);let e=await i.V.deliverSpecificTimeCapsule(t);e.success?r.status(200).json({message:"Time capsule delivered successfully",delivered:e.delivered,errors:e.errors,timestamp:new Date().toISOString()}):r.status(400).json({message:"Failed to deliver time capsule",delivered:e.delivered,errors:e.errors,timestamp:new Date().toISOString()})}else{console.log("\uD83D\uDE80 Processing immediate delivery for all ready time capsules");let e=await i.V.deliverTimeCapsulesImmediately();r.status(200).json({message:"Time capsule delivery processed",delivered:e.delivered,totalCapsules:e.totalCapsules,errors:e.errors,timestamp:new Date().toISOString()})}}catch(e){console.error("‚ùå Error in immediate delivery API:",e),r.status(500).json({message:"Internal server error during immediate delivery",error:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()})}}i=(s.then?(await s)():s)[0],a()}catch(e){a(e)}})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=5088);module.exports=t})();