"use strict";(()=>{var e={};e.id=412,e.ids=[412],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5184:e=>{e.exports=require("nodemailer")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},5306:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>d,default:()=>c,routeModule:()=>m});var s=t(1802),i=t(7153),o=t(6249),l=t(446),n=e([l]);l=(n.then?(await n)():n)[0];let c=(0,o.l)(l,"default"),d=(0,o.l)(l,"config"),m=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/test-time-capsule",pathname:"/api/test-time-capsule",bundlePath:"",filename:""},userland:l});a()}catch(e){a(e)}})},7192:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{db:()=>c});var s=t(3745),i=t(1492),o=t(401),l=e([s,i,o]);[s,i,o]=l.then?(await l)():l;let n=(0,s.initializeApp)({apiKey:"AIzaSyCChi0l5ugHn8q83GfrC1dY4Sihn2HwHUA",authDomain:"forfutureme-55cd2.firebaseapp.com",projectId:"forfutureme-55cd2",storageBucket:"forfutureme-55cd2.firebasestorage.app",messagingSenderId:"822297739285",appId:"1:822297739285:web:bcc265c9c349d118a24e1c",measurementId:"G-WKNWXRY24T"}),c=(0,i.getFirestore)(n);(0,o.getAuth)(n),a()}catch(e){a(e)}})},919:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{V:()=>m});var s=t(1492),i=t(7192),o=t(5184),l=t.n(o),n=e([s,i]);[s,i]=n.then?(await n)():n;let c=()=>l().createTransport({service:"gmail",auth:{user:process.env.EMAIL_USER,pass:process.env.EMAIL_PASS}}),d=e=>`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <title>Your Time Capsule Message Has Arrived! ‚è∞</title>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .message-box { background: white; padding: 25px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea; }
        .message-text { font-style: italic; font-size: 18px; line-height: 1.6; color: #555; }
        .footer { text-align: center; margin-top: 30px; color: #666; font-size: 14px; }
        .timestamp { background: #e8f4fd; padding: 15px; border-radius: 5px; margin: 15px 0; font-size: 14px; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>‚è∞ Your Time Capsule Message Has Arrived!</h1>
          <p>A message from your past self has reached its destination</p>
        </div>
        
        <div class="content">
          <div class="timestamp">
            <strong>Sent on:</strong> ${e.createdAt.toLocaleDateString()} at ${e.createdAt.toLocaleTimeString()}<br>
            <strong>Delivered on:</strong> ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
          </div>
          
          <div class="message-box">
            <div class="message-text">${e.message}</div>
          </div>
          
          <p style="text-align: center; margin-top: 30px;">
            <em>"The best time to plant a tree was 20 years ago. The second best time is now."</em>
          </p>
        </div>
        
        <div class="footer">
          <p>Sent with ‚ù§Ô∏è from TimeSend</p>
          <p>Your personal time capsule service</p>
        </div>
      </div>
    </body>
    </html>
  `,m={async createTimeCapsule(e){try{return(await (0,s.addDoc)((0,s.collection)(i.db,"timeCapsules"),{...e,createdAt:s.Timestamp.now(),isDelivered:!1,deliveryDate:s.Timestamp.fromDate(e.deliveryDate)})).id}catch(e){throw console.error("Error creating time capsule:",e),Error("Failed to create time capsule")}},async getTimeCapsulesByEmail(e){try{let r=(0,s.query)((0,s.collection)(i.db,"timeCapsules"),(0,s.where)("emails","array-contains",e),(0,s.where)("isDelivered","==",!1)),t=await (0,s.getDocs)(r),a=[];return t.forEach(e=>{let r=e.data();a.push({id:e.id,message:r.message,emails:r.emails,deliveryDate:r.deliveryDate.toDate(),createdAt:r.createdAt.toDate(),isDelivered:r.isDelivered})}),a}catch(e){throw console.error("Error getting time capsules:",e),Error("Failed to get time capsules")}},async markAsDelivered(e){try{let r=(0,s.doc)(i.db,"timeCapsules",e);await (0,s.deleteDoc)(r)}catch(e){throw console.error("Error marking time capsule as delivered:",e),Error("Failed to mark time capsule as delivered")}},async getTimeCapsulesReadyForDelivery(){try{let e=new Date,r=(0,s.query)((0,s.collection)(i.db,"timeCapsules"),(0,s.where)("deliveryDate","<=",s.Timestamp.fromDate(e)),(0,s.where)("isDelivered","==",!1)),t=await (0,s.getDocs)(r),a=[];return t.forEach(e=>{let r=e.data();a.push({id:e.id,message:r.message,emails:r.emails,deliveryDate:r.deliveryDate.toDate(),createdAt:r.createdAt.toDate(),isDelivered:r.isDelivered})}),a}catch(e){throw console.error("Error getting time capsules ready for delivery:",e),Error("Failed to get time capsules ready for delivery")}},async deliverTimeCapsulesImmediately(){try{console.log("\uD83D\uDD50 Starting immediate time capsule delivery...");let e=await this.getTimeCapsulesReadyForDelivery();if(console.log(`üì¶ Found ${e.length} time capsules ready for delivery`),0===e.length)return{delivered:0,totalCapsules:0,errors:[]};let r=0,t=[],a=c();for(let s of e)if(s.id){for(let e of(console.log(`üìß Processing time capsule ${s.id} for immediate delivery`),s.emails))try{console.log(`üì§ Sending email to ${e}...`);let t={from:process.env.EMAIL_USER,to:e,subject:"‚è∞ Your Time Capsule Message Has Arrived!",html:d(s)},i=await a.sendMail(t);console.log(`‚úÖ Email sent successfully to ${e}:`,i.messageId),r++}catch(a){let r=`Failed to send email to ${e}: ${a instanceof Error?a.message:"Unknown error"}`;console.error(`‚ùå ${r}`),t.push(r)}try{await this.markAsDelivered(s.id),console.log(`‚úÖ Time capsule ${s.id} marked as delivered`)}catch(r){let e=`Failed to mark time capsule ${s.id} as delivered: ${r instanceof Error?r.message:"Unknown error"}`;console.error(`‚ùå ${e}`),t.push(e)}}return console.log(`üéâ Immediate delivery complete! ${r} emails sent`),{delivered:r,totalCapsules:e.length,errors:t}}catch(e){throw console.error("‚ùå Error processing immediate time capsule delivery:",e),Error(`Failed to process immediate delivery: ${e instanceof Error?e.message:"Unknown error"}`)}},async isTimeCapsuleReadyForDelivery(e){try{let r=new Date,t=(0,s.query)((0,s.collection)(i.db,"timeCapsules"),(0,s.where)("__name__","==",e),(0,s.where)("deliveryDate","<=",s.Timestamp.fromDate(r)),(0,s.where)("isDelivered","==",!1));return!(await (0,s.getDocs)(t)).empty}catch(e){return console.error("Error checking if time capsule is ready for delivery:",e),!1}},async deliverSpecificTimeCapsule(e){try{if(!await this.isTimeCapsuleReadyForDelivery(e))return{success:!1,delivered:0,errors:["Time capsule is not ready for delivery yet"]};let r=(await this.getTimeCapsulesReadyForDelivery()).find(r=>r.id===e);if(!r)return{success:!1,delivered:0,errors:["Time capsule not found or already delivered"]};let t=0,a=[],s=c();for(let i of(console.log(`üìß Processing specific time capsule ${e} for immediate delivery`),r.emails))try{console.log(`üì§ Sending email to ${i}...`);let e={from:process.env.EMAIL_USER,to:i,subject:"‚è∞ Your Time Capsule Message Has Arrived!",html:d(r)},a=await s.sendMail(e);console.log(`‚úÖ Email sent successfully to ${i}:`,a.messageId),t++}catch(r){let e=`Failed to send email to ${i}: ${r instanceof Error?r.message:"Unknown error"}`;console.error(`‚ùå ${e}`),a.push(e)}try{await this.markAsDelivered(e),console.log(`‚úÖ Time capsule ${e} marked as delivered`)}catch(t){let r=`Failed to mark time capsule ${e} as delivered: ${t instanceof Error?t.message:"Unknown error"}`;console.error(`‚ùå ${r}`),a.push(r)}return{success:!0,delivered:t,errors:a}}catch(e){return console.error("‚ùå Error processing specific time capsule delivery:",e),{success:!1,delivered:0,errors:[`Failed to process delivery: ${e instanceof Error?e.message:"Unknown error"}`]}}}};a()}catch(e){a(e)}})},446:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>o});var s=t(919),i=e([s]);async function o(e,r){if("GET"!==e.method)return r.status(405).json({message:"Method not allowed"});try{console.log("\uD83E\uDDEA Testing time capsule service...");let e={message:"Test message from backend",emails:["test@example.com"],deliveryDate:new Date(Date.now()+31536e6)},t=await s.V.createTimeCapsule(e);console.log(`‚úÖ Test time capsule created with ID: ${t}`);let a=await s.V.getTimeCapsulesByEmail("test@example.com");console.log(`üì¶ Found ${a.length} capsules for test email`),r.status(200).json({message:"Time capsule service test completed!",testData:{capsuleId:t,message:e.message,emails:e.emails,deliveryDate:e.deliveryDate,foundCapsules:a.length}})}catch(e){console.error("‚ùå Error testing time capsule service:",e),r.status(500).json({message:"Error testing time capsule service",error:e instanceof Error?e.message:"Unknown error"})}}s=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=5306);module.exports=t})();